<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Color Generator + Tier List</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #1e1e1e;
    color: white;
    margin: 0;
    padding: 0;
    text-align: center;
  }
  h1 { margin-top: 20px; }
  #generator {
    padding: 20px;
    background-color: #2a2a2a;
    margin: 10px auto;
    width: 95%;
    border-radius: 12px;
  }
  #colorBox {
    width: 90%;
    height: 150px;
    margin: 10px auto;
    border-radius: 12px;
    border: 2px solid #444;
  }
  .stars span {
    font-size: 28px;
    cursor: pointer;
    color: gray;
    user-select: none;
  }
  .stars span.active {
    color: gold;
  }
  #tierList {
    margin-top: 20px;
    background-color: #252525;
    padding: 15px;
    border-radius: 12px;
    width: 95%;
    margin: 20px auto;
  }
  .tier {
    margin: 10px auto;
    padding: 10px;
    border-radius: 8px;
  }
  .tier h2 {
    margin-bottom: 10px;
  }
  .color-card {
    display: inline-block;
    width: 80px;
    height: 40px;
    margin: 5px;
    border-radius: 6px;
    cursor: grab;
    color: white;
    font-weight: bold;
    line-height: 40px;
  }
  footer {
    margin-top: 20px;
    font-size: 0.9em;
    color: #aaa;
  }
  button, select {
    background-color: #444;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 14px;
    cursor: pointer;
    font-size: 14px;
  }
  button:hover, select:hover {
    background-color: #666;
  }
</style>
</head>
<body>
<h1>üé® Color Generator + Tier List</h1>

<div id="generator">
  <div id="colorBox"></div>
  <p id="hexLabel">#FFFFFF</p>
  <p id="nameLabel">Loading...</p>
  
  <select id="langSelect" aria-label="language">
    <option value="EN">EN</option>
    <option value="DE">DE</option>
    <option value="NL">NL</option>
  </select>
  <br><br>
  
  <div>
    <p>Rate how much you like it:</p>
    <div id="likeStars" class="stars"></div>
    <p>Rate how combinable it is:</p>
    <div id="comboStars" class="stars"></div>
  </div>
  <br>
  <button id="nextBtn">Next Color</button>
</div>

<div id="tierList"></div>

<footer>
  Habedere Aurich, en ook, haii schatje ‚ù§Ô∏è
</footer>

<script>
  const saturationAdjectives = [
    [0.0, 0.2, ["Pale","Soft","Muted","Faded","Washed","Dim","Subdued","Neutral"]],
    [0.2, 0.5, ["Gentle","Calm","Balanced","Moderate","Mild","Harmonious","Fair","Smooth"]],
    [0.5, 0.8, ["Vivid","Bright","Radiant","Strong","Bold","Lively","Vibrant","Rich"]],
    [0.8, 1.0, ["Intense","Dazzling","Flaming","Brilliant","Glowing","Striking","Electric","Explosive"]]
  ];

  const lightnessAdjectives = [
    [0.0, 0.2, ["Shadowed","Deep","Dusky","Gloomy","Obscure","Moody","Brooding","Midnight"]],
    [0.2, 0.5, ["Dim","Muted","Softened","Shaded","Faded","Hazy","Smoky","Ashen"]],
    [0.5, 0.8, ["Light","Gentle","Transparent","Fair","Soft","Clear","Mellow","Polished"]],
    [0.8, 1.0, ["Bright","Glowing","Radiant","Shining","Dazzling","Glittering","Lucent","Sunny"]]
  ];

  const fancyColorMap = [
    [0, 15, "Crimson"], [15, 35, "Ruby"], [35, 60, "Amber"], [60, 80, "Lemon"],
    [80, 110, "Mint"], [110, 150, "Emerald"], [150, 190, "Seafoam"], [190, 210, "Turquoise"],
    [210, 230, "Cobalt"], [230, 250, "Royal"], [250, 270, "Indigo"], [270, 290, "Violet"],
    [290, 310, "Lilac"], [310, 330, "Magenta"], [330, 345, "Pink"], [345, 360, "Crimson"]
  ];

  const baseColorMap = [
    [0, 30, "Red"], [30, 60, "Orange"], [60, 90, "Yellow"], [90, 150, "Green"],
    [150, 210, "Cyan"], [210, 270, "Blue"], [270, 330, "Purple"], [330, 360, "Red"]
  ];

  let ratings = JSON.parse(localStorage.getItem("colorRatings") || "[]");
  let currentColor = null;
  let likeRating = 0;
  let comboRating = 0;

  const colorBox = document.getElementById("colorBox");
  const hexLabel = document.getElementById("hexLabel");
  const nameLabel = document.getElementById("nameLabel");
  const nextBtn = document.getElementById("nextBtn");
  const langSelect = document.getElementById("langSelect");

  // HSV helpers
  function rgbToHsv(r, g, b) {
    r /= 255; g /= 255; b /= 255;
    let max = Math.max(r,g,b), min = Math.min(r,g,b);
    let h, s, v = max;
    let d = max - min;
    s = max === 0 ? 0 : d / max;
    if (max === min) h = 0;
    else {
      switch(max){
        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
        case g: h = (b - r) / d + 2; break;
        case b: h = (r - g) / d + 4; break;
      }
      h /= 6;
    }
    return [h, s, v];
  }

  function generateHexColor() {
    return "#" + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
  }

  function pickAdj(value, map) {
    for (const [start,end,words] of map) {
      if (value >= start && value < end) return words[Math.floor(Math.random()*words.length)];
    }
    return "Neutral";
  }

  function getBaseColor(hue, s, v) {
    if (s < 0.2 && v > 0.8) return "White";
    if (s < 0.2 && v < 0.2) return "Black";
    if (s < 0.2) return "Gray";
    for (const [start,end,color] of baseColorMap) {
      if (hue >= start && hue < end) return color;
    }
    return "Unknown";
  }

  function getFancyColor(hue, base) {
    for (const [start,end,color] of fancyColorMap) {
      if (hue >= start && hue < end && color.toLowerCase() !== base.toLowerCase()) return color;
    }
    return base;
  }

  async function translateText(text, targetLang) {
    if (targetLang === "EN") return text;
    try {
      const response = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=${targetLang.toLowerCase()}&dt=t&q=${encodeURIComponent(text)}`);
      const data = await response.json();
      return data[0][0][0];
    } catch {
      return text;
    }
  }

  async function generateColor() {
    const hex = generateHexColor();
    const r = parseInt(hex.slice(1,3),16);
    const g = parseInt(hex.slice(3,5),16);
    const b = parseInt(hex.slice(5,7),16);
    const [h,s,v] = rgbToHsv(r,g,b);
    const hueDeg = h * 360;
    const nameEN = `${pickAdj(s, saturationAdjectives)} ${pickAdj(v, lightnessAdjectives)} ${getFancyColor(hueDeg, getBaseColor(hueDeg,s,v))} ${getBaseColor(hueDeg,s,v)}`;
    const translated = await translateText(nameEN, langSelect.value);

    currentColor = {hex, nameEN, translated};
    colorBox.style.backgroundColor = hex;
    hexLabel.textContent = hex;
    nameLabel.textContent = translated;
  }

  // Star rating system
  function createStars(containerId, callback) {
    const container = document.getElementById(containerId);
    container.innerHTML = "";
    for (let i=1;i<=10;i++){
      const star = document.createElement("span");
      star.textContent = "‚òÜ";
      star.addEventListener("click",()=>{
        callback(i);
        updateStars(container, i);
      });
      container.appendChild(star);
    }
  }

  function updateStars(container, value){
    const stars = container.querySelectorAll("span");
    stars.forEach((s,idx)=>{
      s.classList.toggle("active", idx < value);
      s.textContent = idx < value ? "‚òÖ" : "‚òÜ";
    });
  }

  function updateTierList(){
    const tierContainer = document.getElementById("tierList");
    tierContainer.innerHTML = "";
    const tiers = {
      "S": ratings.filter(r=>r.avg>=8),
      "A": ratings.filter(r=>r.avg>=5 && r.avg<8),
      "B": ratings.filter(r=>r.avg>=3 && r.avg<5),
      "C": ratings.filter(r=>r.avg>=2 && r.avg<3),
      "Shit": ratings.filter(r=>r.avg<2)
    };
    for (const [tierName,colors] of Object.entries(tiers)){
      const div = document.createElement("div");
      div.className = "tier";
      div.style.backgroundColor = tierName==="S" ? "#2e2e2e" : "#3a3a3a";
      div.innerHTML = `<h2>${tierName} Tier</h2>`;
      colors.forEach(c=>{
        const card = document.createElement("div");
        card.className = "color-card";
        card.style.backgroundColor = c.hex;
        card.textContent = c.hex;
        card.draggable = true;
        card.addEventListener("dragstart", e=>{
          e.dataTransfer.setData("text/plain", c.hex);
        });
        div.appendChild(card);
      });
      div.addEventListener("dragover", e=>e.preventDefault());
      div.addEventListener("drop", e=>{
        e.preventDefault();
        const hex = e.dataTransfer.getData("text/plain");
        const color = ratings.find(r=>r.hex===hex);
        if (color){
          for (const t of Object.keys(tiers)) {
            const arr = ratings.filter(r=>r.avg>=(
              t==="S"?8:t==="A"?5:t==="B"?3:t==="C"?2:-Infinity
            ));
          }
          color.avg = tierName==="S"?9:tierName==="A"?6:tierName==="B"?4:tierName==="C"?2.5:1;
          localStorage.setItem("colorRatings", JSON.stringify(ratings));
          updateTierList();
        }
      });
      tierContainer.appendChild(div);
    }
  }

  nextBtn.addEventListener("click", async ()=>{
    if (currentColor && likeRating && comboRating){
      const avg = (likeRating+comboRating)/2;
      ratings.push({hex: currentColor.hex, name: currentColor.translated, avg});
      localStorage.setItem("colorRatings", JSON.stringify(ratings));
      updateTierList();
    }
    likeRating = 0;
    comboRating = 0;
    updateStars(document.getElementById("likeStars"),0);
    updateStars(document.getElementById("comboStars"),0);
    await generateColor();
  });

  langSelect.addEventListener("change", async ()=>{
    if (!currentColor) return;
    const translated = await translateText(currentColor.nameEN, langSelect.value);
    currentColor.translated = translated;
    nameLabel.textContent = translated;
  });

  createStars("likeStars", val => likeRating = val);
  createStars("comboStars", val => comboRating = val);

  updateTierList();
  generateColor();
</script>
</body>
</html>
